---
title: "Linear Regression Analysis and Visualisation"
format: html
---

```{r}
#| message: true
#| warning: true

# Install packages, load libraries
if(!require("tidyverse"))
  install.packages("tidyverse")
  library(tidyverse)

if(!require("DBI"))
  install.packages("DBI")
  library(DBI)

if(!require("RSQLite"))
  install.packages("RSQLite")
  library(RSQLite)

if(!require("kableExtra"))
  install.packages("kableExtra")
  library(kableExtra)

if(!require("DT"))
  install.packages("DT")
  library(DT)

if(!require("ggplot2"))
  install.packages("ggplot2")
  library(ggplot2)

if(!require("dplyr"))
  install.packages("dplyr")
  library(dplyr)

if(!require("broom"))
  install.packages("broom")
  library(broom)

# Connect to database
conn <- dbConnect(RSQLite::SQLite(), "virtual_production.db")

```

```{r}
#| message: true
#| warning: true

# Select information from production, title and budget, Count the unique crew members on each and assign value to production status from the Productions table and Join with ProductionCrew Table and group by ID, Title, Budget and Status

part1 <- "SELECT p.ProductionID, p.Title, p.Budget, COUNT(DISTINCT pc.CrewID) AS CrewSize, p.Status, CASE WHEN p.Status = 'Completed' THEN 1 WHEN p.Status = 'Post-Production' THEN 0.75 WHEN p.Status = 'Shooting' THEN 0.5 ELSE 0.25 END AS SuccessRate FROM Productions p LEFT JOIN ProductionCrew pc ON p.ProductionID = pc.ProductionID GROUP BY p.ProductionID, p.Title, p.Budget, p.Status;"

# Queries the database and runs part1
data1 <- dbGetQuery(conn, part1)

# Adds results to a table
head(data1)

# Display Table with results
kable(result1, caption = 'Total Budget and Project Count per Country') %>% kable_styling(full_width = FALSE, position = "center", bootstrap_options = c("striped", "hover"))

```
