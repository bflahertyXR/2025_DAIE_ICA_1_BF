---
title: "Technology Exploration of new R Packages"
---
For this section, I have explored the creative use of R packages to visualise data from the same SQL query in three different ways. 

It Includes:

-   **Plotly:** Interactive Visualisation
-   **Rayshader:** 3D Rendering
-   **Tidymodels:** Using Machine Learning

```{r}
#| label: Install and Load Libraries
#| message: true
#| warning: true
#| include: false

# Install packages, load libraries
if(!require("tidyverse"))
  install.packages("tidyverse")
  library(tidyverse)

if(!require("DBI"))
  install.packages("DBI")
  library(DBI)

if(!require("RSQLite"))
  install.packages("RSQLite")
  library(RSQLite)

if(!require("DT"))
  install.packages("DT")
  library(DT)

if(!require("dplyr"))
  install.packages("dplyr")
  library(dplyr)

if(!require("ggplot2"))
  install.packages("ggplot2")
  library(ggplot2)

if(!require("plotly"))
  install.packages("plotly")
  library(plotly)

if(!require("GGally"))
  install.packages("GGally")
  library(GGally)

if(!require("ggthemes"))
  install.packages("ggthemes")
  library(ggthemes)

if(!require("scales"))
  install.packages("scales")
  library(scales)

# Connect to database
conn <- dbConnect(RSQLite::SQLite(), "virtual_production.db")

```

```{r}
#| label: Run Query 
#| message: true
#| warning: true
#| include: false

# Queries the database and runs part1
data <- dbGetQuery(conn, "SELECT Productions.ProductionID, Productions.Title, Productions.Budget, COUNT(DISTINCT ProductionCrew.CrewID) AS CrewSize, Productions.Status FROM Productions LEFT JOIN ProductionCrew ON Productions.ProductionID = ProductionCrew.ProductionID GROUP BY Productions.ProductionID, Productions.Title, Productions.Budget, Productions.Status;")

# Queries the database and runs part1
data <- data %>% mutate(SuccessRate = case_when(Status == "Completed" ~ 1, Status == "In Progress" ~ 0.5, TRUE ~ 0))

head(data)

```

#Interactive Visualisation with Plotly
The Plotly library allows for interactive exploration and users can see dynamic overview of budget and Success Rate

```{r}

# Queries the database and runs part1
p <- ggplot(data, aes(x = Budget, y = SuccessRate, size = CrewSize, colour = Status, text = Title)) + geom_point(alpha = 0.7) + labs(title = "Budget vs Success Rate") + theme_minimal()

# Queries the database and runs part1
ggplotly(p, tooltip = c("text", "x", "y"))

```

#GGally
Extends ggplot2 with pairwise plots and correlation and gives an overview of the relationship between variables for exploratory data analysis

```{r}
#| label: GGally 
#| echo: false
#| message: true
#| warning: true

num_data <- data %>% select(Budget, CrewSize, SuccessRate)
ggpairs(num_data, title = "Pairwise Relationship Between Key Variables", upper = list(continuous = wrap("cor", size = 3)), diag = list(continuous = wrap("densityDiag", alpha = 0.6)), lower = list(continuous = wrap("points", alpha = 0.6)))

```

#R-Graph Gallery


```{r}
#| label: R-Graph Gallery
#| echo: false
#| message: true
#| warning: true

# Queries the database and runs part1
ggplot(data, aes(x = CrewSize, y = SuccessRate, fill = Status)) + geom_boxplot(alpha = 0.7, colour = "grey30") + scale_fill_brewer(palette = "Set2") + labs(title = "Crew Size vs SuccessRate", x = "Crew Size", y = "Success Rate (0-1)") + theme_clean() + theme(plot.title = element_text(size = 14, face = "bold"))

heat_data <- data %>% mutate(BudgetBin = cut(Budget, breaks = 10, labels = FALSE), CrewBin = cut(CrewSize, breaks = 10, labels = FALSE)) %>% group_by(BudgetBin, CrewBin) %>% summarise(AvgSuccess = mean(SuccessRate, na.rm = TRUE)) %>% ungroup()

ggplot(heat_data, aes(x = BudgetBin, y = CrewBin, fill = AvgSuccess)) + geom_tile(color = "white", linewidth = 0.3) + scale_fill_gradient(low = '#56b1f7', high = '#132B43', name = "Avg Success") + labs(title = "Heatmap of Success Rate by Budget ands Crew Size", x = "Budget" , y = "Crew Size") + theme_minimal() +theme(plot.title = element_text(size = 14, face = "bold"), legend.position = "right")

```

```{r}
#| label: Disconnect from database
#| message: true
#| warning: true
#| include: false

dbDisconnect(conn)

```

